{
  "version": 3,
  "names": [
    "browserSupportsTextareaTextNodes",
    "canManipulateViaTextNodes",
    "input",
    "nodeName",
    "textarea",
    "document",
    "createElement",
    "value",
    "firstChild",
    "insertAtLineStart",
    "val",
    "cursorIdx",
    "content",
    "startIdx",
    "char",
    "focus",
    "setRangeText",
    "dispatchEvent",
    "Event",
    "bubbles",
    "insertTextAtPosition",
    "text",
    "selection",
    "ieRange",
    "createRange",
    "collapse",
    "select",
    "isSuccess",
    "execCommand",
    "start",
    "selectionStart",
    "end",
    "selectionEnd",
    "range",
    "textNode",
    "createTextNode",
    "node",
    "appendChild",
    "offset",
    "startNode",
    "endNode",
    "nodeLength",
    "nodeValue",
    "length",
    "setStart",
    "setEnd",
    "nextSibling",
    "deleteContents",
    "commonAncestorContainer",
    "insertNode",
    "slice",
    "setSelectionRange",
    "e",
    "createEvent",
    "initEvent"
  ],
  "sources": [
    "../../src/utils/InsertTextAtPosition.ts"
  ],
  "sourcesContent": [
    "/**\n * The MIT License\n * Copyright (c) 2018 Dmitriy Kubyshkin\n * Copied from https://github.com/grassator/insert-text-at-cursor\n */\n\nlet browserSupportsTextareaTextNodes: any;\n\n/**\n * @param {HTMLElement} input\n * @return {boolean}\n */\nfunction canManipulateViaTextNodes(input: HTMLTextAreaElement | HTMLInputElement): boolean {\n  if (input.nodeName !== 'TEXTAREA') {\n    return false;\n  }\n  if (typeof browserSupportsTextareaTextNodes === 'undefined') {\n    const textarea: HTMLTextAreaElement = document.createElement('textarea');\n    textarea.value = '1';\n    browserSupportsTextareaTextNodes = !!textarea.firstChild;\n  }\n  return browserSupportsTextareaTextNodes;\n}\n\n/**\n * @param {string} val\n * @param {number} cursorIdx\n * @param {HTMLTextAreaElement|HTMLInputElement} input\n * @return {void}\n */\nexport const insertAtLineStart = (\n  val: string,\n  cursorIdx: number,\n  input: HTMLTextAreaElement | HTMLInputElement,\n): void => {\n  const content = input.value;\n  let startIdx = 0;\n\n  while (cursorIdx--) {\n    let char = content[cursorIdx];\n    if (char === '\\n') {\n      startIdx = cursorIdx + 1;\n      break;\n    }\n  }\n\n  input.focus();\n  input.setRangeText(val, startIdx, startIdx);\n  input.dispatchEvent(new Event('input', { bubbles: true }));\n};\n\n/**\n * @param {HTMLTextAreaElement|HTMLInputElement} input\n * @param {string} text\n * @returns {void}\n */\nexport function insertTextAtPosition(input: HTMLTextAreaElement | HTMLInputElement, text: string): void {\n  // Most of the used APIs only work with the field selected\n  input.focus();\n\n  // IE 8-10\n  if ((document as any).selection) {\n    const ieRange = (document as any).selection.createRange();\n    ieRange.text = text;\n\n    // Move cursor after the inserted text\n    ieRange.collapse(false /* to the end */);\n    ieRange.select();\n\n    return;\n  }\n\n  // Webkit + Edge\n  const isSuccess = document.execCommand && document.execCommand('insertText', false, text);\n  if (!isSuccess) {\n    const start = input.selectionStart!;\n    const end = input.selectionEnd!;\n    // Firefox (non-standard method)\n    if (typeof input.setRangeText === 'function') {\n      input.setRangeText(text);\n    } else {\n      // To make a change we just need a Range, not a Selection\n      const range = document.createRange();\n      const textNode = document.createTextNode(text);\n\n      if (canManipulateViaTextNodes(input)) {\n        let node = input.firstChild;\n\n        // If textarea is empty, just insert the text\n        if (!node) {\n          input.appendChild(textNode);\n        } else {\n          // Otherwise we need to find a nodes for start and end\n          let offset = 0;\n          let startNode = null;\n          let endNode = null;\n\n          while (node && (startNode === null || endNode === null)) {\n            const nodeLength = node.nodeValue!.length;\n\n            // if start of the selection falls into current node\n            if (start >= offset && start <= offset + nodeLength) {\n              range.setStart((startNode = node), start - offset);\n            }\n\n            // if end of the selection falls into current node\n            if (end >= offset && end <= offset + nodeLength) {\n              range.setEnd((endNode = node), end - offset);\n            }\n\n            offset += nodeLength;\n            node = node.nextSibling;\n          }\n\n          // If there is some text selected, remove it as we should replace it\n          if (start !== end) {\n            range.deleteContents();\n          }\n        }\n      }\n\n      // If the node is a textarea and the range doesn't span outside the element\n      //\n      // Get the commonAncestorContainer of the selected range and test its type\n      // If the node is of type `#text` it means that we're still working with text nodes within our textarea element\n      // otherwise, if it's of type `#document` for example it means our selection spans outside the textarea.\n      if (canManipulateViaTextNodes(input) && range.commonAncestorContainer.nodeName === '#text') {\n        // Finally insert a new node. The browser will automatically split start and end nodes into two if necessary\n        range.insertNode(textNode);\n      } else {\n        // If the node is not a textarea or the range spans outside a textarea the only way is to replace the whole value\n        const value = input.value;\n        input.value = value.slice(0, start) + text + value.slice(end);\n      }\n    }\n\n    // Correct the cursor position to be at the end of the insertion\n    input.setSelectionRange(start + text.length, start + text.length);\n\n    // Notify any possible listeners of the change\n    const e = document.createEvent('UIEvent');\n    e.initEvent('input', true, false);\n    input.dispatchEvent(e);\n  }\n}\n"
  ],
  "mappings": "AAAA;AACA;AACA;AACA;AACA;;AAEA,IAAIA,gCAAqC;;AAEzC;AACA;AACA;AACA;AACA,SAASC,yBAAyB,CAACC,KAA6C,EAAW;EACzF,IAAIA,KAAK,CAACC,QAAQ,KAAK,UAAU,EAAE;IACjC,OAAO,KAAK;EACd;EACA,IAAI,OAAOH,gCAAgC,KAAK,WAAW,EAAE;IAC3D,IAAMI,QAA6B,GAAGC,QAAQ,CAACC,aAAa,CAAC,UAAU,CAAC;IACxEF,QAAQ,CAACG,KAAK,GAAG,GAAG;IACpBP,gCAAgC,GAAG,CAAC,CAACI,QAAQ,CAACI,UAAU;EAC1D;EACA,OAAOR,gCAAgC;AACzC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,IAAMS,iBAAiB,GAAG,CAC/BC,GAAW,EACXC,SAAiB,EACjBT,KAA6C,KACpC;EACT,IAAMU,OAAO,GAAGV,KAAK,CAACK,KAAK;EAC3B,IAAIM,QAAQ,GAAG,CAAC;EAEhB,OAAOF,SAAS,EAAE,EAAE;IAClB,IAAIG,IAAI,GAAGF,OAAO,CAACD,SAAS,CAAC;IAC7B,IAAIG,IAAI,KAAK,IAAI,EAAE;MACjBD,QAAQ,GAAGF,SAAS,GAAG,CAAC;MACxB;IACF;EACF;EAEAT,KAAK,CAACa,KAAK,EAAE;EACbb,KAAK,CAACc,YAAY,CAACN,GAAG,EAAEG,QAAQ,EAAEA,QAAQ,CAAC;EAC3CX,KAAK,CAACe,aAAa,CAAC,IAAIC,KAAK,CAAC,OAAO,EAAE;IAAEC,OAAO,EAAE;EAAK,CAAC,CAAC,CAAC;AAC5D,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,oBAAoB,CAAClB,KAA6C,EAAEmB,IAAY,EAAQ;EACtG;EACAnB,KAAK,CAACa,KAAK,EAAE;;EAEb;EACA,IAAKV,QAAQ,CAASiB,SAAS,EAAE;IAC/B,IAAMC,OAAO,GAAIlB,QAAQ,CAASiB,SAAS,CAACE,WAAW,EAAE;IACzDD,OAAO,CAACF,IAAI,GAAGA,IAAI;;IAEnB;IACAE,OAAO,CAACE,QAAQ,CAAC,KAAK,CAAC,iBAAiB;IACxCF,OAAO,CAACG,MAAM,EAAE;IAEhB;EACF;;EAEA;EACA,IAAMC,SAAS,GAAGtB,QAAQ,CAACuB,WAAW,IAAIvB,QAAQ,CAACuB,WAAW,CAAC,YAAY,EAAE,KAAK,EAAEP,IAAI,CAAC;EACzF,IAAI,CAACM,SAAS,EAAE;IACd,IAAME,KAAK,GAAG3B,KAAK,CAAC4B,cAAe;IACnC,IAAMC,GAAG,GAAG7B,KAAK,CAAC8B,YAAa;IAC/B;IACA,IAAI,OAAO9B,KAAK,CAACc,YAAY,KAAK,UAAU,EAAE;MAC5Cd,KAAK,CAACc,YAAY,CAACK,IAAI,CAAC;IAC1B,CAAC,MAAM;MACL;MACA,IAAMY,KAAK,GAAG5B,QAAQ,CAACmB,WAAW,EAAE;MACpC,IAAMU,QAAQ,GAAG7B,QAAQ,CAAC8B,cAAc,CAACd,IAAI,CAAC;MAE9C,IAAIpB,yBAAyB,CAACC,KAAK,CAAC,EAAE;QACpC,IAAIkC,IAAI,GAAGlC,KAAK,CAACM,UAAU;;QAE3B;QACA,IAAI,CAAC4B,IAAI,EAAE;UACTlC,KAAK,CAACmC,WAAW,CAACH,QAAQ,CAAC;QAC7B,CAAC,MAAM;UACL;UACA,IAAII,MAAM,GAAG,CAAC;UACd,IAAIC,SAAS,GAAG,IAAI;UACpB,IAAIC,OAAO,GAAG,IAAI;UAElB,OAAOJ,IAAI,KAAKG,SAAS,KAAK,IAAI,IAAIC,OAAO,KAAK,IAAI,CAAC,EAAE;YACvD,IAAMC,UAAU,GAAGL,IAAI,CAACM,SAAS,CAAEC,MAAM;;YAEzC;YACA,IAAId,KAAK,IAAIS,MAAM,IAAIT,KAAK,IAAIS,MAAM,GAAGG,UAAU,EAAE;cACnDR,KAAK,CAACW,QAAQ,CAAEL,SAAS,GAAGH,IAAI,EAAGP,KAAK,GAAGS,MAAM,CAAC;YACpD;;YAEA;YACA,IAAIP,GAAG,IAAIO,MAAM,IAAIP,GAAG,IAAIO,MAAM,GAAGG,UAAU,EAAE;cAC/CR,KAAK,CAACY,MAAM,CAAEL,OAAO,GAAGJ,IAAI,EAAGL,GAAG,GAAGO,MAAM,CAAC;YAC9C;YAEAA,MAAM,IAAIG,UAAU;YACpBL,IAAI,GAAGA,IAAI,CAACU,WAAW;UACzB;;UAEA;UACA,IAAIjB,KAAK,KAAKE,GAAG,EAAE;YACjBE,KAAK,CAACc,cAAc,EAAE;UACxB;QACF;MACF;;MAEA;MACA;MACA;MACA;MACA;MACA,IAAI9C,yBAAyB,CAACC,KAAK,CAAC,IAAI+B,KAAK,CAACe,uBAAuB,CAAC7C,QAAQ,KAAK,OAAO,EAAE;QAC1F;QACA8B,KAAK,CAACgB,UAAU,CAACf,QAAQ,CAAC;MAC5B,CAAC,MAAM;QACL;QACA,IAAM3B,KAAK,GAAGL,KAAK,CAACK,KAAK;QACzBL,KAAK,CAACK,KAAK,GAAGA,KAAK,CAAC2C,KAAK,CAAC,CAAC,EAAErB,KAAK,CAAC,GAAGR,IAAI,GAAGd,KAAK,CAAC2C,KAAK,CAACnB,GAAG,CAAC;MAC/D;IACF;;IAEA;IACA7B,KAAK,CAACiD,iBAAiB,CAACtB,KAAK,GAAGR,IAAI,CAACsB,MAAM,EAAEd,KAAK,GAAGR,IAAI,CAACsB,MAAM,CAAC;;IAEjE;IACA,IAAMS,CAAC,GAAG/C,QAAQ,CAACgD,WAAW,CAAC,SAAS,CAAC;IACzCD,CAAC,CAACE,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,KAAK,CAAC;IACjCpD,KAAK,CAACe,aAAa,CAACmC,CAAC,CAAC;EACxB;AACF"
}