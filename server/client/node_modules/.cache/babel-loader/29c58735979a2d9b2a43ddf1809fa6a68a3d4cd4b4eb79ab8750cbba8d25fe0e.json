{"ast":null,"code":"/*\r\n * common.js: Internal helper and utility functions for winston\r\n *\r\n * (C) 2010 Charlie Robbins\r\n * MIT LICENCE\r\n *\r\n */\n\nvar util = require('util'),\n  crypto = require('crypto'),\n  cycle = require('cycle'),\n  fs = require('fs'),\n  StringDecoder = require('string_decoder').StringDecoder,\n  Stream = require('stream').Stream,\n  config = require('./config');\n\n//\n// ### function setLevels (target, past, current)\n// #### @target {Object} Object on which to set levels.\n// #### @past {Object} Previous levels set on target.\n// #### @current {Object} Current levels to set on target.\n// Create functions on the target objects for each level\n// in current.levels. If past is defined, remove functions\n// for each of those levels.\n//\nexports.setLevels = function (target, past, current, isDefault) {\n  var self = this;\n  if (past) {\n    Object.keys(past).forEach(function (level) {\n      delete target[level];\n    });\n  }\n  target.levels = current || config.npm.levels;\n  if (target.padLevels) {\n    target.levelLength = exports.longestElement(Object.keys(target.levels));\n  }\n\n  //\n  //  Define prototype methods for each log level\n  //  e.g. target.log('info', msg) <=> target.info(msg)\n  //\n  Object.keys(target.levels).forEach(function (level) {\n    // TODO Refactor logging methods into a different object to avoid name clashes\n    if (level === 'log') {\n      console.warn('Log level named \"log\" will clash with the method \"log\". Consider using a different name.');\n      return;\n    }\n    target[level] = function (msg) {\n      // build argument list (level, msg, ... [string interpolate], [{metadata}], [callback])\n      var args = [level].concat(Array.prototype.slice.call(arguments));\n      target.log.apply(target, args);\n    };\n  });\n  return target;\n};\n\n//\n// ### function longestElement\n// #### @xs {Array} Array to calculate against\n// Returns the longest element in the `xs` array.\n//\nexports.longestElement = function (xs) {\n  return Math.max.apply(null, xs.map(function (x) {\n    return x.length;\n  }));\n};\n\n//\n// ### function clone (obj)\n// #### @obj {Object} Object to clone.\n// Helper method for deep cloning pure JSON objects\n// i.e. JSON objects that are either literals or objects (no Arrays, etc)\n//\nexports.clone = function (obj) {\n  if (obj instanceof Error) {\n    // With potential custom Error objects, this might not be exactly correct,\n    // but probably close-enough for purposes of this lib.\n    var copy = {\n      message: obj.message\n    };\n    Object.getOwnPropertyNames(obj).forEach(function (key) {\n      copy[key] = obj[key];\n    });\n    return cycle.decycle(copy);\n  } else if (!(obj instanceof Object)) {\n    return obj;\n  } else if (obj instanceof Date) {\n    return new Date(obj.getTime());\n  }\n  return clone(cycle.decycle(obj));\n};\nfunction clone(obj) {\n  //\n  // We only need to clone reference types (Object)\n  //\n  var copy = Array.isArray(obj) ? [] : {};\n  for (var i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      if (Array.isArray(obj[i])) {\n        copy[i] = obj[i].slice(0);\n      } else if (obj[i] instanceof Buffer) {\n        copy[i] = obj[i].slice(0);\n      } else if (typeof obj[i] != 'function') {\n        copy[i] = obj[i] instanceof Object ? exports.clone(obj[i]) : obj[i];\n      } else if (typeof obj[i] === 'function') {\n        copy[i] = obj[i];\n      }\n    }\n  }\n  return copy;\n}\n\n//\n// ### function log (options)\n// #### @options {Object} All information about the log serialization.\n// Generic logging function for returning timestamped strings\n// with the following options:\n//\n//    {\n//      level:     'level to add to serialized message',\n//      message:   'message to serialize',\n//      meta:      'additional logging metadata to serialize',\n//      colorize:  false, // Colorizes output (only if `.json` is false)\n//      align:     false  // Align message level.\n//      timestamp: true   // Adds a timestamp to the serialized message\n//      label:     'label to prepend the message'\n//    }\n//\nexports.log = function (options) {\n  var timestampFn = typeof options.timestamp === 'function' ? options.timestamp : exports.timestamp,\n    timestamp = options.timestamp ? timestampFn() : null,\n    showLevel = options.showLevel === undefined ? true : options.showLevel,\n    meta = options.meta !== null && options.meta !== undefined ? exports.clone(options.meta) : options.meta || null,\n    output;\n\n  //\n  // raw mode is intended for outputing winston as streaming JSON to STDOUT\n  //\n  if (options.raw) {\n    if (typeof meta !== 'object' && meta != null) {\n      meta = {\n        meta: meta\n      };\n    }\n    output = exports.clone(meta) || {};\n    output.level = options.level;\n    //\n    // Remark (jcrugzz): This used to be output.message = options.message.stripColors.\n    // I do not know why this is, it does not make sense but im handling that\n    // case here as well as handling the case that does make sense which is to\n    // make the `output.message = options.message`\n    //\n    output.message = options.message.stripColors ? options.message.stripColors : options.message;\n    return JSON.stringify(output);\n  }\n\n  //\n  // json mode is intended for pretty printing multi-line json to the terminal\n  //\n  if (options.json || true === options.logstash) {\n    if (typeof meta !== 'object' && meta != null) {\n      meta = {\n        meta: meta\n      };\n    }\n    output = exports.clone(meta) || {};\n    output.level = options.level;\n    output.message = output.message || '';\n    if (options.label) {\n      output.label = options.label;\n    }\n    if (options.message) {\n      output.message = options.message;\n    }\n    if (timestamp) {\n      output.timestamp = timestamp;\n    }\n    if (options.logstash === true) {\n      // use logstash format\n      var logstashOutput = {};\n      if (output.message !== undefined) {\n        logstashOutput['@message'] = output.message;\n        delete output.message;\n      }\n      if (output.timestamp !== undefined) {\n        logstashOutput['@timestamp'] = output.timestamp;\n        delete output.timestamp;\n      }\n      logstashOutput['@fields'] = exports.clone(output);\n      output = logstashOutput;\n    }\n    if (typeof options.stringify === 'function') {\n      return options.stringify(output);\n    }\n    return JSON.stringify(output, function (key, value) {\n      return value instanceof Buffer ? value.toString('base64') : value;\n    });\n  }\n\n  //\n  // Remark: this should really be a call to `util.format`.\n  //\n  if (typeof options.formatter == 'function') {\n    options.meta = meta || options.meta;\n    if (options.meta instanceof Error) {\n      // Force converting the Error to an plain object now so it\n      // will not be messed up by decycle() when cloning options\n      options.meta = exports.clone(options.meta);\n    }\n    return String(options.formatter(exports.clone(options)));\n  }\n  output = timestamp ? timestamp + ' - ' : '';\n  if (showLevel) {\n    output += options.colorize === 'all' || options.colorize === 'level' || options.colorize === true ? config.colorize(options.level) : options.level;\n  }\n  output += options.align ? '\\t' : '';\n  output += timestamp || showLevel ? ': ' : '';\n  output += options.label ? '[' + options.label + '] ' : '';\n  output += options.colorize === 'all' || options.colorize === 'message' ? config.colorize(options.level, options.message) : options.message;\n  if (meta !== null && meta !== undefined) {\n    if (typeof meta !== 'object') {\n      output += ' ' + meta;\n    } else if (Object.keys(meta).length > 0) {\n      if (typeof options.prettyPrint === 'function') {\n        output += ' ' + options.prettyPrint(meta);\n      } else if (options.prettyPrint) {\n        output += ' ' + '\\n' + util.inspect(meta, false, options.depth || null, options.colorize);\n      } else if (options.humanReadableUnhandledException && Object.keys(meta).length >= 5 && meta.hasOwnProperty('date') && meta.hasOwnProperty('process') && meta.hasOwnProperty('os') && meta.hasOwnProperty('trace') && meta.hasOwnProperty('stack')) {\n        //\n        // If meta carries unhandled exception data serialize the stack nicely\n        //\n        var stack = meta.stack;\n        delete meta.stack;\n        delete meta.trace;\n        output += ' ' + exports.serialize(meta);\n        if (stack) {\n          output += '\\n' + stack.join('\\n');\n        }\n      } else {\n        output += ' ' + exports.serialize(meta);\n      }\n    }\n  }\n  return output;\n};\nexports.capitalize = function (str) {\n  return str && str[0].toUpperCase() + str.slice(1);\n};\n\n//\n// ### function hash (str)\n// #### @str {string} String to hash.\n// Utility function for creating unique ids\n// e.g. Profiling incoming HTTP requests on the same tick\n//\nexports.hash = function (str) {\n  return crypto.createHash('sha1').update(str).digest('hex');\n};\n\n//\n// ### function pad (n)\n// Returns a padded string if `n < 10`.\n//\nexports.pad = function (n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n};\n\n//\n// ### function timestamp ()\n// Returns a timestamp string for the current time.\n//\nexports.timestamp = function () {\n  return new Date().toISOString();\n};\n\n//\n// ### function serialize (obj, key)\n// #### @obj {Object|literal} Object to serialize\n// #### @key {string} **Optional** Optional key represented by obj in a larger object\n// Performs simple comma-separated, `key=value` serialization for Loggly when\n// logging to non-JSON inputs.\n//\nexports.serialize = function (obj, key) {\n  // symbols cannot be directly casted to strings\n  if (typeof key === 'symbol') {\n    key = key.toString();\n  }\n  if (typeof obj === 'symbol') {\n    obj = obj.toString();\n  }\n  if (obj === null) {\n    obj = 'null';\n  } else if (obj === undefined) {\n    obj = 'undefined';\n  } else if (obj === false) {\n    obj = 'false';\n  }\n  if (typeof obj !== 'object') {\n    return key ? key + '=' + obj : obj;\n  }\n  if (obj instanceof Buffer) {\n    return key ? key + '=' + obj.toString('base64') : obj.toString('base64');\n  }\n  var msg = '',\n    keys = Object.keys(obj),\n    length = keys.length;\n  for (var i = 0; i < length; i++) {\n    if (Array.isArray(obj[keys[i]])) {\n      msg += keys[i] + '=[';\n      for (var j = 0, l = obj[keys[i]].length; j < l; j++) {\n        msg += exports.serialize(obj[keys[i]][j]);\n        if (j < l - 1) {\n          msg += ', ';\n        }\n      }\n      msg += ']';\n    } else if (obj[keys[i]] instanceof Date) {\n      msg += keys[i] + '=' + obj[keys[i]];\n    } else {\n      msg += exports.serialize(obj[keys[i]], keys[i]);\n    }\n    if (i < length - 1) {\n      msg += ', ';\n    }\n  }\n  return msg;\n};\n\n//\n// ### function tailFile (options, callback)\n// #### @options {Object} Options for tail.\n// #### @callback {function} Callback to execute on every line.\n// `tail -f` a file. Options must include file.\n//\nexports.tailFile = function (options, callback) {\n  var buffer = Buffer.alloc(64 * 1024),\n    decode = new StringDecoder('utf8'),\n    stream = new Stream(),\n    buff = '',\n    pos = 0,\n    row = 0;\n  if (options.start === -1) {\n    delete options.start;\n  }\n  stream.readable = true;\n  stream.destroy = function () {\n    stream.destroyed = true;\n    stream.emit('end');\n    stream.emit('close');\n  };\n  fs.open(options.file, 'a+', '0644', function (err, fd) {\n    if (err) {\n      if (!callback) {\n        stream.emit('error', err);\n      } else {\n        callback(err);\n      }\n      stream.destroy();\n      return;\n    }\n    (function read() {\n      if (stream.destroyed) {\n        fs.close(fd, nop);\n        return;\n      }\n      return fs.read(fd, buffer, 0, buffer.length, pos, function (err, bytes) {\n        if (err) {\n          if (!callback) {\n            stream.emit('error', err);\n          } else {\n            callback(err);\n          }\n          stream.destroy();\n          return;\n        }\n        if (!bytes) {\n          if (buff) {\n            if (options.start == null || row > options.start) {\n              if (!callback) {\n                stream.emit('line', buff);\n              } else {\n                callback(null, buff);\n              }\n            }\n            row++;\n            buff = '';\n          }\n          return setTimeout(read, 1000);\n        }\n        var data = decode.write(buffer.slice(0, bytes));\n        if (!callback) {\n          stream.emit('data', data);\n        }\n        var data = (buff + data).split(/\\n+/),\n          l = data.length - 1,\n          i = 0;\n        for (; i < l; i++) {\n          if (options.start == null || row > options.start) {\n            if (!callback) {\n              stream.emit('line', data[i]);\n            } else {\n              callback(null, data[i]);\n            }\n          }\n          row++;\n        }\n        buff = data[l];\n        pos += bytes;\n        return read();\n      });\n    })();\n  });\n  if (!callback) {\n    return stream;\n  }\n  return stream.destroy;\n};\n\n//\n// ### function stringArrayToSet (array)\n// #### @strArray {Array} Array of Set-elements as strings.\n// #### @errMsg {string} **Optional** Custom error message thrown on invalid input.\n// Returns a Set-like object with strArray's elements as keys (each with the value true).\n//\nexports.stringArrayToSet = function (strArray, errMsg) {\n  if (typeof errMsg === 'undefined') {\n    errMsg = 'Cannot make set from Array with non-string elements';\n  }\n  return strArray.reduce(function (set, el) {\n    if (!(typeof el === 'string' || el instanceof String)) {\n      throw new Error(errMsg);\n    }\n    set[el] = true;\n    return set;\n  }, Object.create(null));\n};\nfunction nop() {}","map":{"version":3,"names":["util","require","crypto","cycle","fs","StringDecoder","Stream","config","exports","setLevels","target","past","current","isDefault","self","Object","keys","forEach","level","levels","npm","padLevels","levelLength","longestElement","console","warn","msg","args","concat","Array","prototype","slice","call","arguments","log","apply","xs","Math","max","map","x","length","clone","obj","Error","copy","message","getOwnPropertyNames","key","decycle","Date","getTime","isArray","i","hasOwnProperty","Buffer","options","timestampFn","timestamp","showLevel","undefined","meta","output","raw","stripColors","JSON","stringify","json","logstash","label","logstashOutput","value","toString","formatter","String","colorize","align","prettyPrint","inspect","depth","humanReadableUnhandledException","stack","trace","serialize","join","capitalize","str","toUpperCase","hash","createHash","update","digest","pad","n","toISOString","j","l","tailFile","callback","buffer","alloc","decode","stream","buff","pos","row","start","readable","destroy","destroyed","emit","open","file","err","fd","read","close","nop","bytes","setTimeout","data","write","split","stringArrayToSet","strArray","errMsg","reduce","set","el","create"],"sources":["/home/kty/workspace/seb41_pre_001/client/node_modules/winston/lib/winston/common.js"],"sourcesContent":["/*\r\n * common.js: Internal helper and utility functions for winston\r\n *\r\n * (C) 2010 Charlie Robbins\r\n * MIT LICENCE\r\n *\r\n */\r\n\r\nvar util = require('util'),\r\n    crypto = require('crypto'),\r\n    cycle = require('cycle'),\r\n    fs = require('fs'),\r\n    StringDecoder = require('string_decoder').StringDecoder,\r\n    Stream = require('stream').Stream,\r\n    config = require('./config');\r\n\r\n//\r\n// ### function setLevels (target, past, current)\r\n// #### @target {Object} Object on which to set levels.\r\n// #### @past {Object} Previous levels set on target.\r\n// #### @current {Object} Current levels to set on target.\r\n// Create functions on the target objects for each level\r\n// in current.levels. If past is defined, remove functions\r\n// for each of those levels.\r\n//\r\nexports.setLevels = function (target, past, current, isDefault) {\r\n  var self = this;\r\n  if (past) {\r\n    Object.keys(past).forEach(function (level) {\r\n      delete target[level];\r\n    });\r\n  }\r\n\r\n  target.levels = current || config.npm.levels;\r\n  if (target.padLevels) {\r\n    target.levelLength = exports.longestElement(Object.keys(target.levels));\r\n  }\r\n\r\n  //\r\n  //  Define prototype methods for each log level\r\n  //  e.g. target.log('info', msg) <=> target.info(msg)\r\n  //\r\n  Object.keys(target.levels).forEach(function (level) {\r\n\r\n    // TODO Refactor logging methods into a different object to avoid name clashes\r\n    if (level === 'log') {\r\n      console.warn('Log level named \"log\" will clash with the method \"log\". Consider using a different name.');\r\n      return;\r\n    }\r\n\r\n    target[level] = function (msg) {\r\n      // build argument list (level, msg, ... [string interpolate], [{metadata}], [callback])\r\n      var args = [level].concat(Array.prototype.slice.call(arguments));\r\n      target.log.apply(target, args);\r\n    };\r\n  });\r\n\r\n  return target;\r\n};\r\n\r\n//\r\n// ### function longestElement\r\n// #### @xs {Array} Array to calculate against\r\n// Returns the longest element in the `xs` array.\r\n//\r\nexports.longestElement = function (xs) {\r\n  return Math.max.apply(\r\n    null,\r\n    xs.map(function (x) { return x.length; })\r\n  );\r\n};\r\n\r\n//\r\n// ### function clone (obj)\r\n// #### @obj {Object} Object to clone.\r\n// Helper method for deep cloning pure JSON objects\r\n// i.e. JSON objects that are either literals or objects (no Arrays, etc)\r\n//\r\nexports.clone = function (obj) {\r\n  if (obj instanceof Error) {\r\n    // With potential custom Error objects, this might not be exactly correct,\r\n    // but probably close-enough for purposes of this lib.\r\n    var copy = { message: obj.message };\r\n    Object.getOwnPropertyNames(obj).forEach(function (key) {\r\n      copy[key] = obj[key];\r\n    });\r\n\r\n    return cycle.decycle(copy);\r\n  }\r\n  else if (!(obj instanceof Object)) {\r\n    return obj;\r\n  }\r\n  else if (obj instanceof Date) {\r\n    return new Date(obj.getTime());\r\n  }\r\n\r\n  return clone(cycle.decycle(obj));\r\n};\r\n\r\nfunction clone(obj) {\r\n  //\r\n  // We only need to clone reference types (Object)\r\n  //\r\n  var copy = Array.isArray(obj) ? [] : {};\r\n\r\n  for (var i in obj) {\r\n    if (obj.hasOwnProperty(i)) {\r\n      if (Array.isArray(obj[i])) {\r\n        copy[i] = obj[i].slice(0);\r\n      }\r\n      else if (obj[i] instanceof Buffer) {\r\n        copy[i] = obj[i].slice(0);\r\n      }\r\n      else if (typeof obj[i] != 'function') {\r\n        copy[i] = obj[i] instanceof Object ? exports.clone(obj[i]) : obj[i];\r\n      }\r\n      else if (typeof obj[i] === 'function') {\r\n        copy[i] = obj[i];\r\n      }\r\n    }\r\n  }\r\n\r\n  return copy;\r\n}\r\n\r\n//\r\n// ### function log (options)\r\n// #### @options {Object} All information about the log serialization.\r\n// Generic logging function for returning timestamped strings\r\n// with the following options:\r\n//\r\n//    {\r\n//      level:     'level to add to serialized message',\r\n//      message:   'message to serialize',\r\n//      meta:      'additional logging metadata to serialize',\r\n//      colorize:  false, // Colorizes output (only if `.json` is false)\r\n//      align:     false  // Align message level.\r\n//      timestamp: true   // Adds a timestamp to the serialized message\r\n//      label:     'label to prepend the message'\r\n//    }\r\n//\r\nexports.log = function (options) {\r\n  var timestampFn = typeof options.timestamp === 'function'\r\n        ? options.timestamp\r\n        : exports.timestamp,\r\n      timestamp   = options.timestamp ? timestampFn() : null,\r\n      showLevel   = options.showLevel === undefined ? true : options.showLevel,\r\n      meta        = options.meta !== null && options.meta !== undefined\r\n        ? exports.clone(options.meta)\r\n        : options.meta || null,\r\n      output;\r\n\r\n  //\r\n  // raw mode is intended for outputing winston as streaming JSON to STDOUT\r\n  //\r\n  if (options.raw) {\r\n    if (typeof meta !== 'object' && meta != null) {\r\n      meta = { meta: meta };\r\n    }\r\n    output         = exports.clone(meta) || {};\r\n    output.level   = options.level;\r\n    //\r\n    // Remark (jcrugzz): This used to be output.message = options.message.stripColors.\r\n    // I do not know why this is, it does not make sense but im handling that\r\n    // case here as well as handling the case that does make sense which is to\r\n    // make the `output.message = options.message`\r\n    //\r\n    output.message = options.message.stripColors\r\n      ? options.message.stripColors\r\n      : options.message;\r\n\r\n    return JSON.stringify(output);\r\n  }\r\n\r\n  //\r\n  // json mode is intended for pretty printing multi-line json to the terminal\r\n  //\r\n  if (options.json || true === options.logstash) {\r\n    if (typeof meta !== 'object' && meta != null) {\r\n      meta = { meta: meta };\r\n    }\r\n\r\n    output         = exports.clone(meta) || {};\r\n    output.level   = options.level;\r\n    output.message = output.message || '';\r\n\r\n    if (options.label) { output.label = options.label; }\r\n    if (options.message) { output.message = options.message; }\r\n    if (timestamp) { output.timestamp = timestamp; }\r\n\r\n    if (options.logstash === true) {\r\n      // use logstash format\r\n      var logstashOutput = {};\r\n      if (output.message !== undefined) {\r\n        logstashOutput['@message'] = output.message;\r\n        delete output.message;\r\n      }\r\n\r\n      if (output.timestamp !== undefined) {\r\n        logstashOutput['@timestamp'] = output.timestamp;\r\n        delete output.timestamp;\r\n      }\r\n\r\n      logstashOutput['@fields'] = exports.clone(output);\r\n      output = logstashOutput;\r\n    }\r\n\r\n    if (typeof options.stringify === 'function') {\r\n      return options.stringify(output);\r\n    }\r\n\r\n    return JSON.stringify(output, function (key, value) {\r\n      return value instanceof Buffer\r\n        ? value.toString('base64')\r\n        : value;\r\n    });\r\n  }\r\n\r\n  //\r\n  // Remark: this should really be a call to `util.format`.\r\n  //\r\n  if (typeof options.formatter == 'function') {\r\n    options.meta = meta || options.meta;\r\n    if (options.meta instanceof Error) {\r\n      // Force converting the Error to an plain object now so it\r\n      // will not be messed up by decycle() when cloning options\r\n      options.meta = exports.clone(options.meta);\r\n    }\r\n    return String(options.formatter(exports.clone(options)));\r\n  }\r\n\r\n  output = timestamp ? timestamp + ' - ' : '';\r\n  if (showLevel) {\r\n    output += options.colorize === 'all' || options.colorize === 'level' || options.colorize === true\r\n      ? config.colorize(options.level)\r\n      : options.level;\r\n  }\r\n\r\n  output += (options.align) ? '\\t' : '';\r\n  output += (timestamp || showLevel) ? ': ' : '';\r\n  output += options.label ? ('[' + options.label + '] ') : '';\r\n  output += options.colorize === 'all' || options.colorize === 'message'\r\n    ? config.colorize(options.level, options.message)\r\n    : options.message;\r\n\r\n  if (meta !== null && meta !== undefined) {\r\n    if (typeof meta !== 'object') {\r\n      output += ' ' + meta;\r\n    }\r\n    else if (Object.keys(meta).length > 0) {\r\n      if (typeof options.prettyPrint === 'function') {\r\n        output += ' ' + options.prettyPrint(meta);\r\n      } else if (options.prettyPrint) {\r\n        output += ' ' + '\\n' + util.inspect(meta, false, options.depth || null, options.colorize);\r\n      } else if (\r\n        options.humanReadableUnhandledException\r\n          && Object.keys(meta).length >= 5\r\n          && meta.hasOwnProperty('date')\r\n          && meta.hasOwnProperty('process')\r\n          && meta.hasOwnProperty('os')\r\n          && meta.hasOwnProperty('trace')\r\n          && meta.hasOwnProperty('stack')) {\r\n\r\n        //\r\n        // If meta carries unhandled exception data serialize the stack nicely\r\n        //\r\n        var stack = meta.stack;\r\n        delete meta.stack;\r\n        delete meta.trace;\r\n        output += ' ' + exports.serialize(meta);\r\n\r\n        if (stack) {\r\n          output += '\\n' + stack.join('\\n');\r\n        }\r\n      } else {\r\n        output += ' ' + exports.serialize(meta);\r\n      }\r\n    }\r\n  }\r\n\r\n  return output;\r\n};\r\n\r\nexports.capitalize = function (str) {\r\n  return str && str[0].toUpperCase() + str.slice(1);\r\n};\r\n\r\n//\r\n// ### function hash (str)\r\n// #### @str {string} String to hash.\r\n// Utility function for creating unique ids\r\n// e.g. Profiling incoming HTTP requests on the same tick\r\n//\r\nexports.hash = function (str) {\r\n  return crypto.createHash('sha1').update(str).digest('hex');\r\n};\r\n\r\n//\r\n// ### function pad (n)\r\n// Returns a padded string if `n < 10`.\r\n//\r\nexports.pad = function (n) {\r\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\r\n};\r\n\r\n//\r\n// ### function timestamp ()\r\n// Returns a timestamp string for the current time.\r\n//\r\nexports.timestamp = function () {\r\n  return new Date().toISOString();\r\n};\r\n\r\n//\r\n// ### function serialize (obj, key)\r\n// #### @obj {Object|literal} Object to serialize\r\n// #### @key {string} **Optional** Optional key represented by obj in a larger object\r\n// Performs simple comma-separated, `key=value` serialization for Loggly when\r\n// logging to non-JSON inputs.\r\n//\r\nexports.serialize = function (obj, key) {\r\n  // symbols cannot be directly casted to strings\r\n  if (typeof key === 'symbol') {\r\n    key = key.toString()\r\n  }\r\n  if (typeof obj === 'symbol') {\r\n    obj = obj.toString()\r\n  }\r\n\r\n  if (obj === null) {\r\n    obj = 'null';\r\n  }\r\n  else if (obj === undefined) {\r\n    obj = 'undefined';\r\n  }\r\n  else if (obj === false) {\r\n    obj = 'false';\r\n  }\r\n\r\n  if (typeof obj !== 'object') {\r\n    return key ? key + '=' + obj : obj;\r\n  }\r\n\r\n  if (obj instanceof Buffer) {\r\n    return key ? key + '=' + obj.toString('base64') : obj.toString('base64');\r\n  }\r\n\r\n  var msg = '',\r\n      keys = Object.keys(obj),\r\n      length = keys.length;\r\n\r\n  for (var i = 0; i < length; i++) {\r\n    if (Array.isArray(obj[keys[i]])) {\r\n      msg += keys[i] + '=[';\r\n\r\n      for (var j = 0, l = obj[keys[i]].length; j < l; j++) {\r\n        msg += exports.serialize(obj[keys[i]][j]);\r\n        if (j < l - 1) {\r\n          msg += ', ';\r\n        }\r\n      }\r\n\r\n      msg += ']';\r\n    }\r\n    else if (obj[keys[i]] instanceof Date) {\r\n      msg += keys[i] + '=' + obj[keys[i]];\r\n    }\r\n    else {\r\n      msg += exports.serialize(obj[keys[i]], keys[i]);\r\n    }\r\n\r\n    if (i < length - 1) {\r\n      msg += ', ';\r\n    }\r\n  }\r\n\r\n  return msg;\r\n};\r\n\r\n//\r\n// ### function tailFile (options, callback)\r\n// #### @options {Object} Options for tail.\r\n// #### @callback {function} Callback to execute on every line.\r\n// `tail -f` a file. Options must include file.\r\n//\r\nexports.tailFile = function(options, callback) {\r\n  var buffer = Buffer.alloc(64 * 1024)\r\n    , decode = new StringDecoder('utf8')\r\n    , stream = new Stream\r\n    , buff = ''\r\n    , pos = 0\r\n    , row = 0;\r\n\r\n  if (options.start === -1) {\r\n    delete options.start;\r\n  }\r\n\r\n  stream.readable = true;\r\n  stream.destroy = function() {\r\n    stream.destroyed = true;\r\n    stream.emit('end');\r\n    stream.emit('close');\r\n  };\r\n\r\n  fs.open(options.file, 'a+', '0644', function(err, fd) {\r\n    if (err) {\r\n      if (!callback) {\r\n        stream.emit('error', err);\r\n      } else {\r\n        callback(err);\r\n      }\r\n      stream.destroy();\r\n      return;\r\n    }\r\n\r\n    (function read() {\r\n      if (stream.destroyed) {\r\n        fs.close(fd, nop);\r\n        return;\r\n      }\r\n\r\n      return fs.read(fd, buffer, 0, buffer.length, pos, function(err, bytes) {\r\n        if (err) {\r\n          if (!callback) {\r\n            stream.emit('error', err);\r\n          } else {\r\n            callback(err);\r\n          }\r\n          stream.destroy();\r\n          return;\r\n        }\r\n\r\n        if (!bytes) {\r\n          if (buff) {\r\n            if (options.start == null || row > options.start) {\r\n              if (!callback) {\r\n                stream.emit('line', buff);\r\n              } else {\r\n                callback(null, buff);\r\n              }\r\n            }\r\n            row++;\r\n            buff = '';\r\n          }\r\n          return setTimeout(read, 1000);\r\n        }\r\n\r\n        var data = decode.write(buffer.slice(0, bytes));\r\n\r\n        if (!callback) {\r\n          stream.emit('data', data);\r\n        }\r\n\r\n        var data = (buff + data).split(/\\n+/)\r\n          , l = data.length - 1\r\n          , i = 0;\r\n\r\n        for (; i < l; i++) {\r\n          if (options.start == null || row > options.start) {\r\n            if (!callback) {\r\n              stream.emit('line', data[i]);\r\n            } else {\r\n              callback(null, data[i]);\r\n            }\r\n          }\r\n          row++;\r\n        }\r\n\r\n        buff = data[l];\r\n\r\n        pos += bytes;\r\n\r\n        return read();\r\n      });\r\n    })();\r\n  });\r\n\r\n  if (!callback) {\r\n    return stream;\r\n  }\r\n\r\n  return stream.destroy;\r\n};\r\n\r\n//\r\n// ### function stringArrayToSet (array)\r\n// #### @strArray {Array} Array of Set-elements as strings.\r\n// #### @errMsg {string} **Optional** Custom error message thrown on invalid input.\r\n// Returns a Set-like object with strArray's elements as keys (each with the value true).\r\n//\r\nexports.stringArrayToSet = function (strArray, errMsg) {\r\n  if (typeof errMsg === 'undefined') {\r\n    errMsg = 'Cannot make set from Array with non-string elements';\r\n  }\r\n  return strArray.reduce(function (set, el) {\r\n    if (!(typeof el === 'string' || el instanceof String)) {\r\n      throw new Error(errMsg);\r\n    }\r\n    set[el] = true;\r\n    return set;\r\n  }, Object.create(null));\r\n};\r\n\r\nfunction nop () {}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}